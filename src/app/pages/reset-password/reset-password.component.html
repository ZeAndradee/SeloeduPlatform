<div class="login-container">
  <div class="login-card card">
    <div class="login-header">
      <div class="logo">
        <img src="seloedu-logo.svg" alt="Seloedu Logo" class="logo-icon" />
      </div>
      <h1>Redefinir Senha</h1>
      <p *ngIf="isValidToken">Crie uma nova senha para sua conta</p>
    </div>

    <div *ngIf="verifyingToken" class="text-center">
      <div class="spinner" style="border-top-color: var(--primary-color)"></div>
      <p>Verificando link...</p>
    </div>

    <div *ngIf="!verifyingToken && !isValidToken" class="alert alert-error">
      Link de recuperação inválido ou expirado.
      <br />
      <a routerLink="/forgot-password">Solicitar novo link</a>
    </div>

    <div *ngIf="successMessage">
      <div class="alert alert-success">
        {{ successMessage }}
      </div>
      <button
        routerLink="/login"
        class="btn btn-primary btn-block"
        style="margin-top: 1rem"
      >
        Voltar para Login
      </button>
    </div>

    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
    </div>

    <form
      [formGroup]="resetForm"
      (ngSubmit)="onSubmit()"
      *ngIf="!verifyingToken && isValidToken && !successMessage"
    >
      <div class="input-group">
        <label for="password" class="input-label">Nova Senha</label>
        <input
          type="password"
          id="password"
          formControlName="password"
          class="input-field"
          placeholder="Mínimo 8 caracteres"
          [class.error]="f['password'].touched && f['password'].errors"
        />
        <div
          class="error-message"
          *ngIf="f['password'].touched && f['password'].errors?.['required']"
        >
          Senha é obrigatória
        </div>
        <div
          class="error-message"
          *ngIf="f['password'].touched && f['password'].errors?.['minlength']"
        >
          A senha deve ter no mínimo 8 caracteres
        </div>
      </div>

      <div class="input-group">
        <label for="confirmPassword" class="input-label">Confirmar Senha</label>
        <input
          type="password"
          id="confirmPassword"
          formControlName="confirmPassword"
          class="input-field"
          placeholder="Confirme sua nova senha"
          [class.error]="
            f['confirmPassword'].touched && f['confirmPassword'].errors
          "
        />
        <div
          class="error-message"
          *ngIf="
            f['confirmPassword'].touched &&
            f['confirmPassword'].errors?.['required']
          "
        >
          Confirmação de senha é obrigatória
        </div>
        <div
          class="error-message"
          *ngIf="
            f['confirmPassword'].touched &&
            f['confirmPassword'].errors?.['mismatch']
          "
        >
          As senhas não coincidem
        </div>
      </div>

      <button
        type="submit"
        class="btn btn-primary btn-block"
        [disabled]="loading"
      >
        <span *ngIf="!loading">Redefinir Senha</span>
        <span *ngIf="loading" class="spinner"></span>
      </button>
    </form>

    <div class="login-footer" *ngIf="!successMessage">
      <p>Voltar para Login? <a routerLink="/login">Fazer Login</a></p>
    </div>
  </div>
</div>
